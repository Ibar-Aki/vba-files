# Forms案（無料）実装手順書 v2（NFC→iPhone→Forms→Power Automate→Teams）

**目的**：NFCタッチ → iPhoneでMicrosoft Formsを開き**1タップ送信** → Power Automate（標準）で受信 → **Teamsに自動投稿**。

- 想定所要：初回 **45–60分**／以後5分で再現
- 使用範囲：**Microsoft 365 標準機能のみ（追加費用なし）**
- 方式：**C-1推奨**（URLは端末側に保持、タグはスイッチのみ）

---

## 0. 全体フロー（図解）
```
NFCタッチ → iPhoneショートカット（URLを開く） → Microsoft Forms（開始/終了を送信）
           → Power Automate（新規回答トリガ → 回答詳細取得 → 条件分岐）
           → Microsoft Teams（指定チャネルへ投稿）
```

---

## 1. 前提条件（チェックリスト）
**テナント/サービス**
- [ ] Microsoft 365 の **Forms / Power Automate / Teams** を利用可能
- [ ] Teamsの**投稿先チーム/チャネル**が決定（例：*総務部 / #業務報告*）

**セキュリティ方針**
- [ ] Formsの公開範囲は**「組織内のみ」**（外部回答不可）
- [ ] 回答者名を**自動記録**する（監査用）
- [ ] URL保持方式は **C-1（端末保持）** を採用する

**端末/タグ**
- [ ] iPhoneで**社用M365アカウント**にサインイン済み
- [ ] iPhoneショートカットアプリを使用可（iOS標準）
- [ ] NFCタグ（NTAG互換など）を**必要枚数＋予備1枚**用意
- [ ] タグに**管理番号ラベル**を貼付（例：`WF-001`）

---

## 2. 方式の選択（URLの持ち方）
- **C-1（推奨）**：URLは**iPhoneショートカット**に保存。タグはスイッチのみ（紛失時の影響最小）。
- C-2：タグ内にURLを書込（取り回し最短）。**紛失＝URL露出**のため、漏えい時は**フォーム停止→新リンク発行**で遮断。

---

## 3. Step A：Microsoft Formsの作成（3–5分）
1. **新しいフォーム**を作成（例：`[OPS] 業務状況報告`）
2. **質問**
   - 「**状況**」（**選択**）：*業務開始*／*業務終了*（必須）
   - 「**備考**」（**テキスト**）：任意（自由入力は短文推奨）
   - ※時刻は端末依存を避け、**フロー実行時刻**を採用予定
3. **設定**（右上`…` → **設定**）
   - **このフォームに誰が記入できますか**：**組織内のユーザーのみ**
   - **名前を記録する**：オン
   - **1人1回の回答に制限**：必要に応じてオン（内部連投抑止）
4. **送信** → **リンク** をコピー（共有リンク）

> **補足**：自由入力は最小に。固定選択で誤入力と不正値を抑止します。

---

## 4. Step B：Power Automate（無料）でTeams投稿（5–8分）
1. **自動化クラウドフロー** → **空白から作成**
2. **トリガ**：*Microsoft Forms → 新しい回答が送信されたとき*
   - **Form Id**：Step Aのフォームを選択
3. **アクション**：*Microsoft Forms → 回答の詳細を取得*
   - **Form Id**：同上
   - **Response Id**：トリガの**応答ID**
4. **条件**：質問「状況」の値
   - *業務開始* → Teams投稿（開始テンプレ）
   - *業務終了* → Teams投稿（終了テンプレ）
5. **Teams投稿**：*Microsoft Teams → メッセージをチャネルに投稿*
   - **チーム/チャネル**：投稿先を指定
   - **本文テンプレ（例）**：
     - 1行目：`📋 業務状況報告`
     - 2行目：`⏰ 受付時刻：{フロー実行時刻}`
     - 3行目：`👤 回答者：{DisplayName}`
     - 4行目：`📍 状況：{業務開始|業務終了}`
6. **（任意）監査ログ**：SharePointリストへ「回答ID/回答者/受付時刻/状況/備考」を保存

> **コツ**：まず“開始”だけで試験 → OKなら“終了”分岐を追加すると迷いません。

---

## 5. Step C：iPhone＋NFCの設定（5–10分）
### C-1（推奨）：URLは端末に保持
1. **ショートカット** → **オートメーション** → `＋` → **個人用オートメーションを作成** → **NFC**
2. **スキャン** → タグをかざす → 名前（例：`業務タグ`）→ **次へ**
3. **アクションを追加** → **URL** にFormsの共有リンクを貼付 → **URLを開く**
4. **実行前に尋ねる**：**オフ** → **完了**

### C-2：URLをタグに書込（最短）
1. 「NFC Tools」等でタグに**フォームURLを書込**
2. かざすと直接フォームが開く

> **注意**：C-2はタグ紛失時にURLが第三者へ見えるため、**組織限定**は必須。漏えい時は**受付停止→新リンク発行**で即遮断。

---

## 6. 受け入れテスト（3分）
- [ ] タグにタッチ → **Formsが開く**
- [ ] 「状況：**業務開始**」で**送信** → Teamsに**開始報告**が表示
- [ ] 「状況：**業務終了**」で送信 → Teamsに**終了報告**が表示
- [ ] Formsの回答一覧に**回答者名/内容**が正しく記録

---

## 7. トラブルシューティング（要点）
| 症状 | 原因候補 | 対処 |
|---|---|---|
| フローが動かない | Form Id/接続の不一致 | フローのトリガと「回答の詳細」を同じフォームに、接続を再サインイン |
| 外部からも開ける | 共有設定が「全員」 | **「組織内のみ」**へ変更、既存リンクは共有停止＆再発行 |
| 同一人物が連投 | 仕様/運用 | **「1人1回」**ON、またはフローで短時間重複を破棄 |
| Teamsに投稿されない | 接続/対象チャネル誤り | Teamsコネクタの**チーム/チャネル/接続**を再設定 |
| タグ紛失 | C-1/C-2差 | C-1：オートメーションOFFで終了／C-2：フォーム**停止→新リンク**→新タグへ |

---

## 8. セキュリティ運用とローテーション
- **公開範囲の最小化**：Formsは**組織内限定**、必要なら**特定ユーザー/グループのみ**
- **本人性**：回答者名の自動記録を必須化
- **URL管理**：基本はC-1。C-2運用時は、**漏えい時SOP**（受付停止→新リンク→タグ再書込）を手順化
- **監査**：月次でForms回答＆フロー実行履歴を点検、必要に応じSharePointへ写し

---

## 9. 運用チェックリスト（導入〜月次）
**導入時**
- [ ] Teams：投稿先チャネル確定（例：`#業務報告-自動`）
- [ ] Forms：組織限定・名前記録オン・リンク取得
- [ ] Power Automate：トリガ（新規回答）→詳細取得→Teams投稿
- [ ] iPhone：C-1オートメーション作成、テスト完了

**月次**
- [ ] Forms回答の棚卸し（不要回答のクリーンアップ）
- [ ] フロー失敗の有無＆再試行確認
- [ ] タグ台帳（紛失/交換）の確認

---

## 10. テンプレ（貼り付け用）
**Teams投稿（本文）**
```
📋 業務状況報告
⏰ 受付時刻：{フロー実行時刻}
👤 回答者：{DisplayName}
📍 状況：{業務開始|業務終了}
```

**命名例**
- フォーム名：`[OPS] 業務状況報告`
- フロー名：`[OPS] Forms→Teams 業務報告`
- チャネル名：`#業務報告-自動投稿`

---

### 完了
この手順書はそのまま運用開始に使えます。必要に応じて、チーム名・チャネル名・本文テンプレを貴社用に微調整してください。
