# フェーズ1 システム取扱説明書

このドキュメントは、フェーズ1で構築した「Shortcut Mail Tool」を含む定型メール支援システムを、IT 知識が少ない方向けに説明するものです。日常的な操作の流れと、うまく動かないときに確認すべきポイントをまとめています。

---

## 1. システム概要
- **目的**: 定型メールの宛先や本文を一覧から選び、素早くクリップボードにコピーできるよう支援します。
- **構成要素**:
  - Excel マクロブック（例: `sample_data.xlsm`）
  - メール定型文データ (`sample_data.csv`)
  - VBA モジュール (`ShortcutMailTool.bas` 他)
  - ビルド・更新用スクリプト (`build.bat`, `tools/Build-VbaProject.ps1`)
- **成果物**: 設定済みの Excel ブックを配布することで、ユーザーは番号を入力するだけで必要な文章をコピーできます。

---

## 2. 事前準備
1. **動作環境**
   - Windows 11 または Windows 10
   - Microsoft Excel 2016 / Microsoft 365
   - PowerShell 5.1 以上（Windows に標準で含まれています）
2. **必須ファイル**
   - `sample_data.xlsm`: マクロを含む Excel ファイル
   - `sample_data.csv`: 定型文データ
   - フォルダ構成一式（`src`, `template`, `tools`, `build` など）
3. **フォルダ配置**
   - 上記ファイルを同じフォルダ内に配置します。例: `C:\ShortcutMailTool\`
   - `sample_data.csv` はブックと同じ場所に置いてください。

---

## 3. 初めて使うときの設定
1. Excel で `sample_data.xlsm` を開きます。
2. 画面上部に表示される「セキュリティの警告」で **[コンテンツの有効化]** をクリックし、マクロを許可します。
3. 以後の利用をスムーズにするため、Excel を一度閉じて再起動すると安定します。
4. 共有フォルダで運用する場合は、閲覧専用（読み取り専用）に設定し、CSV 編集者を限定すると安心です。

---

## 4. 日常の操作手順
1. Excel を開いた状態で **Alt + F8** を押します。
2. マクロ一覧から **ShowShortcutMailMenu** を選び、[実行] をクリック。
3. 表示される番号付きリストから、コピーしたい項目番号を入力します。
4. ダイアログが閉じたらコピー完了です。メールやチャットに **Ctrl + V** で貼り付けます。

### 4.1 CSV を更新する場合
1. `sample_data.csv` をメモ帳などのテキストエディタで開きます。
2. 1 行目は `Label,Content` のままにします。
3. 2 行目以降へ「表示したい名前（Label）」と「コピーしたい本文（Content）」をカンマ区切りで入力し、上書き保存します。
4. Excel に戻り、再度マクロを実行すると最新内容が表示されます。

---

## 5. システム管理者向け: ビルドと配布
1. `build.bat` をダブルクリックすると、PowerShell スクリプトが自動で呼び出され、最新の VBA モジュールを `.xlsm` テンプレートに反映します。
2. 実行結果は `build` フォルダに出力されるため、生成された `.xlsm` をユーザーへ配布してください。
3. VBA コードを更新した場合は、`src/vba/modules` や `shortcut-mail-tool` 内の `.bas` を編集した後、再度 `build.bat` を実行してください。

---

## 6. トラブルシューティング
| 症状 | 確認ポイント |
|------|---------------|
| 「CSV ファイルが見つかりません」 | `sample_data.csv` が Excel ブックと同じフォルダにあるか確認。ファイル名を変更していないかチェック。 |
| 「データが読み込めませんでした」 | CSV の1行目が `Label,Content` になっているか、空行やカンマ抜けがないか確認。保存形式を UTF-8 に設定。 |
| 「メモリが不足しています」 | Excel や常駐しているクリップボードツールがクリップボードを掴んでいる場合があります。Excel を再起動し、他のクリップボード監視ソフトを一時停止。必要なら PC を再起動。 |
| 貼り付けた文字が化ける | CSV を UTF-8 で保存する。Excel を再起動し、再度マクロを実行。 |
| マクロが表示されない | `Alt + F8` を押しても一覧に無い場合、マクロが無効化されている可能性あり。再度コンテンツを有効化する。 |

---

## 7. よくある質問 (FAQ)
- **Q. CSV にカンマを含む文章を入れたい場合は？**  
  A. 対象行をダブルクォーテーション (`"`) で囲んで保存してください。
- **Q. ショートカットで直接マクロを呼び出せますか？**  
  A. Excel のクイックアクセスツールバーに `ShowShortcutMailMenu` を登録すると、ワンクリックで起動できます。
- **Q. 新しい PC にセットアップするには？**  
  A. フォルダ一式をコピーし、初回起動時にマクロを有効化するだけで利用できます。追加のインストールは不要です。

---

## 8. 保守と今後の拡張メモ
- フェーズ2 以降では、Outlook 連携や UI 改善を予定しています。今回の CSV ベース運用を踏まえ、追加データ項目が増える場合はヘッダー行を拡張してください。
- VBA コードを修正する際は、`shortcut-mail-tool/ShortcutMailTool.bas` にコメントを残し、Git でバージョン管理する運用を推奨します。

---

## 9. 連絡先
- 運用管理者: __________________
- サポート用メールアドレス: __________________
- ドキュメント最終更新日: 2025-09-18
